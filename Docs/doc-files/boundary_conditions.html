<!DOCTYPE html>

<html>
<head>
  <link rel="icon" type="image/png" href="../../images/fish.png">
  <title>boundary_conditions.jl</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" media="all" href="./jocco.css" />
  <link rel="stylesheet" href="http://dobtco.github.io/jquery-resizable-columns/dist/jquery.resizableColumns.css">
  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <!-- jQuery -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="http://dobtco.github.io/jquery-resizable-columns/dist/jquery.resizableColumns.min.js"></script>
  <script>
    $(function(){
      $("table").resizableColumns({
        store: window.store
      });
    });
  </script>
</head>
<body>
<nav>
	<ul>
		<li><a href="../index.html#">Home</a></li>
		<li>
      		<a href="openBF.html">openBF.jl <span class="caret"></span></a>
			<div>
				<ul>
        <li><a href="main.html#">main.jl</a>

<li><a href="BTypes.html#">BTypes.jl<span class="caret"></span></a>
<div>
<ul><li><a href="BTypes.html#::Vessel
">::Vessel
</a></li>
<li><a href="BTypes.html#::Heart
">::Heart
</a></li>
<li><a href="BTypes.html#::Blood
">::Blood
</a></li>
</ul>
</div>
</li><li><a href="initialise.html#">initialise.jl<span class="caret"></span></a>
<div>
<ul><li><a href="initialise.html#projectPreamble
">projectPreamble
</a></li>
<li><a href="initialise.html#writeScripts
">writeScripts
</a></li>
<li><a href="initialise.html#cleanLibrary
">cleanLibrary
</a></li>
<li><a href="initialise.html#readModelData
">readModelData
</a></li>
<li><a href="initialise.html#initialiseVessel
">initialiseVessel
</a></li>
<li><a href="initialise.html#loadInputData
">loadInputData
</a></li>
<li><a href="initialise.html#loadGlobalConstants
">loadGlobalConstants
</a></li>
</ul>
</div>
</li><li><a href="boundary_conditions.html#">boundary_conditions.jl<span class="caret"></span></a>
<div>
<ul><li><a href="boundary_conditions.html#setInletBC
">setInletBC
</a></li>
<li><a href="boundary_conditions.html#sinHeaviside
">sinHeaviside
</a></li>
<li><a href="boundary_conditions.html#heaviside
">heaviside
</a></li>
<li><a href="boundary_conditions.html#gauss
">gauss
</a></li>
<li><a href="boundary_conditions.html#inputFromData
">inputFromData
</a></li>
<li><a href="boundary_conditions.html#inletCompatibility
">inletCompatibility
</a></li>
<li><a href="boundary_conditions.html#setOutletBC
">setOutletBC
</a></li>
<li><a href="boundary_conditions.html#outletCompatibility
">outletCompatibility
</a></li>
<li><a href="boundary_conditions.html#wk3
">wk3
</a></li>
<li><a href="boundary_conditions.html#updateGhostCells
">updateGhostCells
</a></li>
</ul>
</div>
</li><li><a href="junctions.html#">junctions.jl<span class="caret"></span></a>
<div>
<ul><li><a href="junctions.html#joinVessels
">joinVessels
</a></li>
</ul>
</div>
</li><li><a href="conjunctions.html#">conjunctions.jl<span class="caret"></span></a>
<div>
<ul><li><a href="conjunctions.html#solveConjunction
">solveConjunction
</a></li>
<li><a href="conjunctions.html#calculateWstarConj
">calculateWstarConj
</a></li>
<li><a href="conjunctions.html#calculateFofUconj
">calculateFofUconj
</a></li>
<li><a href="conjunctions.html#calculateJacobianConj
">calculateJacobianConj
</a></li>
</ul>
</div>
</li><li><a href="bifurcations.html#">bifurcations.jl<span class="caret"></span></a>
<div>
<ul><li><a href="bifurcations.html#solveBifurcation
">solveBifurcation
</a></li>
<li><a href="bifurcations.html#calculateWstarBif
">calculateWstarBif
</a></li>
<li><a href="bifurcations.html#calculateFofUBif
">calculateFofUBif
</a></li>
<li><a href="bifurcations.html#calculateJacobianBif
">calculateJacobianBif
</a></li>
</ul>
</div>
</li><li><a href="godunov.html#">godunov.jl<span class="caret"></span></a>
<div>
<ul><li><a href="godunov.html#Godunov
">Godunov
</a></li>
<li><a href="godunov.html#riemannSolver
">riemannSolver
</a></li>
<li><a href="godunov.html#fL
">fL
</a></li>
<li><a href="godunov.html#fR
">fR
</a></li>
<li><a href="godunov.html#flux
">flux
</a></li>
<li><a href="godunov.html#source
">source
</a></li>
<li><a href="godunov.html#calculateDeltaT
">calculateDeltaT
</a></li>
<li><a href="godunov.html#solveModel
">solveModel
</a></li>
</ul>
</div>
</li><li><a href="MUSCL.html#">MUSCL.jl<span class="caret"></span></a>
<div>
<ul><li><a href="MUSCL.html#computeFlux
">computeFlux
</a></li>
<li><a href="MUSCL.html#minMod
">minMod
</a></li>
<li><a href="MUSCL.html#maxmod
">maxmod
</a></li>
<li><a href="MUSCL.html#minmod
">minmod
</a></li>
<li><a href="MUSCL.html#superBee
">superBee
</a></li>
<li><a href="MUSCL.html#computeLimiter
">computeLimiter
</a></li>
<li><a href="MUSCL.html#MUSCL
">MUSCL
</a></li>
</ul>
</div>
</li><li><a href="converter.html#">converter.jl<span class="caret"></span></a>
<div>
<ul><li><a href="converter.html#waveSpeed
">waveSpeed
</a></li>
<li><a href="converter.html#pressure
">pressure
</a></li>
<li><a href="converter.html#areaFromPressure
">areaFromPressure
</a></li>
<li><a href="converter.html#riemannInvariants
">riemannInvariants
</a></li>
<li><a href="converter.html#rI2uc
">rI2uc
</a></li>
<li><a href="converter.html#calculatePrimitives
">calculatePrimitives
</a></li>
</ul>
</div>
</li><li><a href="check_convergence.html#">check_convergence.jl<span class="caret"></span></a>
<div>
<ul><li><a href="check_convergence.html#checkAllQuantities
">checkAllQuantities
</a></li>
<li><a href="check_convergence.html#extractWaveform
">extractWaveform
</a></li>
<li><a href="check_convergence.html#resampleAndCalculateError
">resampleAndCalculateError
</a></li>
</ul>
</div>
</li><li><a href="IOutils.html#">IOutils.jl<span class="caret"></span></a>
<div>
<ul><li><a href="IOutils.html#openTempFiles
">openTempFiles
</a></li>
<li><a href="IOutils.html#closeTempFiles
">closeTempFiles
</a></li>
<li><a href="IOutils.html#saveTempData
">saveTempData
</a></li>
<li><a href="IOutils.html#transferTempToOut">transferTempToOut</a></li>
</ul>
</div>




				</ul>
			</div>
		</li>
		<li><a href="../doc-index.html">API Index</a></li>
	</ul>
</nav>
  <div id="container">
    <div id="background"></div>
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs" data-resizable-column-id="docs">
            <h1>
              boundary_conditions.jl
            </h1>
          </th>
          <th class="code" data-resizable-column-id="code">
          </th>
        </tr>
      </thead>
      <tbody>

<tr id="section-1">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-1">&#182;</a>
  </div>
  <p>Inlet and outlet boundary conditions are applied at the beginning and at the ending of each time step respectively (see <a href="godunov.html#solveModel"><code>solveModel</code></a>). Inlet (outlet) condition is applied by setting flow (pressure) value at the first (last) vessel node. <a href="boundary_conditions.html#inletCompatibility">Inlet</a> and <a href="boundary_conditions.html#outletCompatibility">outlet</a> compatibility relations are defined to compute the remaining quantities: <code>P</code>, <code>u</code>, <code>A</code>, <code>c</code>, and <code>Q</code>, <code>u</code>, <code>A</code>, <code>c</code> respectively.</p>

</td>
<td class="code">
<div class="highlight"><pre><span></span>
</pre></div>
</td>
</tr>

<tr id="section-2">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-2">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>setInletBC</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>t</code></td>
<td><code>::Float</code> current time in seconds.</td>
</tr>
<tr class="even">
<td align="left"><code>dt</code></td>
<td><code>::Float</code> <span class="math inline">\(\Delta t\)</span>, current time step.</td>
</tr>
<tr class="odd">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vessel data structure.</td>
</tr>
<tr class="even">
<td align="left"><code>h</code></td>
<td><code>::Heart</code> heart data structure.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">The flow (pressure) at the first node of the vessel (<code>Q[1]</code>) can be set by several functions. This function is selected by <code>BC_switch</code> from <code>h</code> data structure. The inlet compatibility relations are handled by <a href="boundary_conditions.html#inletCompatibility"><code>inletCompatibility</code></a>.</td>
</tr>
</tbody>
</table>
<p><a name="setInletBC"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">setInletBC</span><span class="p">(</span><span class="n">t</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span>
                    <span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">,</span>  <span class="n">h</span>  <span class="o">::</span> <span class="n">Heart</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">BC_switch</span> <span class="o">==</span> <span class="mi">1</span>
		<span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinHeaviside</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

	<span class="k">elseif</span> <span class="n">h</span><span class="o">.</span><span class="n">BC_switch</span> <span class="o">==</span> <span class="mi">2</span>
		<span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

	<span class="k">elseif</span> <span class="n">h</span><span class="o">.</span><span class="n">BC_switch</span> <span class="o">==</span> <span class="mi">3</span>
      	<span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">inlet_type</span> <span class="o">==</span> <span class="s">&quot;Q&quot;</span>
    			<span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputFromData</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
      	<span class="k">else</span>
    			<span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputFromData</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
      	<span class="k">end</span>
	<span class="k">end</span>

	<span class="n">inletCompatibility</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-3">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-3">&#182;</a>
  </div>
  <p><code>heart_data.BC_switch</code> = 1 sets a half sine flow waveform at the vessel inlet. Flow values at each time step are computed by the following function:</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-4">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-4">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>sinHeaviside</code></strong> <span class="math inline">\(\rightarrow\)</span> <code>flow::Float</code></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>t</code></td>
<td><code>::Float</code> current time in seconds.</td>
</tr>
<tr class="even">
<td align="left"><code>h</code></td>
<td><code>::Heart</code> heart data structure.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">The flow waveform is always bigger than the initial flow rate assigned at the initialisation step, i.e. <code>initial_flow</code> (<span class="math inline">\(Q_i\)</span> in the picture). The sinusoid is multiplied by the desired maximum flow rate <code>flow_amplitude</code> (<span class="math inline">\(A_Q\)</span>), and by the <a href="boundary_conditions.html#heaviside"><code>heaviside</code></a> step function. This is done in order to ensure only a positive inlet flow. We want also the waveform to be different than zero for the entire length of the systole, defined by <code>h.sys_T</code> variable. This is done by setting the <code>sin</code> argument as <span class="math inline">\(\frac{2 \pi t}{T_s}\)</span>. In this way we can define a systolic impulse as narrow as wanted without worrying about the cardiac period which is completely unrelated.</td>
</tr>
</tbody>
</table>
<div style="text-align:center">
<img src="images/sinheaviside.pdf.png" width="200">
</div>
<table>
<colgroup>
<col width="13%" />
<col width="86%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Returns:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>Q</code></td>
<td><code>::Float</code> flow rate value at current time.</td>
</tr>
</tbody>
</table>
<p><a name="sinHeaviside"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">sinHeaviside</span><span class="p">(</span><span class="n">t</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">h</span> <span class="o">::</span> <span class="n">Heart</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">flow_amplitude</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">h</span><span class="o">.</span><span class="n">sys_T</span><span class="p">)</span><span class="o">*</span><span class="n">heaviside</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">+</span><span class="n">h</span><span class="o">.</span><span class="n">sys_T</span><span class="o">*</span><span class="mf">0.5</span><span class="p">))</span> <span class="o">+</span>
          <span class="n">h</span><span class="o">.</span><span class="n">initial_flow</span>
<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-5">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-5">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>heaviside</code></strong> <span class="math inline">\(\rightarrow\)</span> <code>::Float</code></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>n</code></td>
<td><code>::Float</code></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math display">\[
H(n) = \begin{cases}
0 \quad \text{if } n &lt; 0, \\
1 \quad \text{if } n \geq 0.
\end{cases}
\]</span></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Returns:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>H</code></td>
<td><code>::Float</code> either 1 or 0.</td>
</tr>
</tbody>
</table>
<p><a name="heaviside"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">heaviside</span><span class="p">(</span><span class="n">n</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">0.</span>

		<span class="k">return</span> <span class="mf">0.</span>

	<span class="k">else</span>

		<span class="k">return</span> <span class="mf">1.</span>

	<span class="k">end</span>

<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-6">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-6">&#182;</a>
  </div>
  <p><code>heart_data.BC_switch</code> = 2 sets a gaussian shaperd flow waveform at the vessel inlet. The bell shape has smoother transition at <span class="math inline">\(T_s\)</span> than <a href="boundary_conditions.html#sinHeaviside"><code>sinHeaviside</code></a>. As a result, the numerical scheme produces less oscillations due to that discontinuity. Flow values at each time step are computed by the following function:</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-7">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-7">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>gauss</code></strong> <span class="math inline">\(\rightarrow\)</span> <code>flow::Float</code></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>t</code></td>
<td><code>::Float</code> current time in seconds.</td>
</tr>
<tr class="even">
<td align="left"><code>h</code></td>
<td><code>::Heart</code> heart data structure.</td>
</tr>
</tbody>
</table>
<p><a name="gauss"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">gauss</span><span class="p">(</span><span class="n">t</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">h</span> <span class="o">::</span> <span class="n">Heart</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-8">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-8">&#182;</a>
  </div>
  <table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>t_hat</code> variable tells us how many cardiac cycles have already been simulated. This is calculated with <code>div(a, b)</code> which returns <code>a/b</code>, truncating to an integer.</td>
</tr>
</tbody>
</table>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">t_hat</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">cardiac_T</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-9">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-9">&#182;</a>
  </div>
  <p>The gaussian bell should span the entire systolic period <code>h.sys_T</code> length. For <code>gauss</code> to return a value different than zero, the current time <code>t</code> must be within the current systolic period <code>h.sys_T</code> (<span class="math inline">\(T_s\)</span>).</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">sys_T</span> <span class="o">+</span> <span class="n">h</span><span class="o">.</span><span class="n">cardiac_T</span><span class="o">*</span><span class="n">t_hat</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">h</span><span class="o">.</span><span class="n">cardiac_T</span><span class="o">*</span><span class="n">t_hat</span>

</pre></div>
</td>
</tr>

<tr id="section-10">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-10">&#182;</a>
  </div>
  <p>When this is confirmed, the inlet flow rate reads <span class="math display">\[
  Q = A_Q \exp{\left(- \frac{\left(t - \hat{t} T -
  \tfrac{T_s}{2}\right)^2}{2 \left(\tfrac{T_s}{8}\right)^2 }\right)}
  + Q_i.
\]</span> Variables are the same as those used in <a href="boundary_conditions.html#sinHeaviside"><code>sinHeaviside</code></a>.</p>

</td>
<td class="code">
<div class="highlight"><pre>		<span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">flow_amplitude</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t_hat</span><span class="o">*</span><span class="n">h</span><span class="o">.</span><span class="n">cardiac_T</span> <span class="o">-</span><span class="n">h</span><span class="o">.</span><span class="n">sys_T</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">/</span>
            <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">sys_T</span><span class="o">*</span><span class="mf">0.125</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">initial_flow</span>

</pre></div>
</td>
</tr>

<tr id="section-11">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-11">&#182;</a>
  </div>
  <p>Otherwise only the <code>initial_flow</code> is returned.</p>
<table>
<colgroup>
<col width="14%" />
<col width="85%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Returns:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>Q</code></td>
<td><code>::Float</code> inlet flow rate at current time.</td>
</tr>
</tbody>
</table>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="k">else</span>
		<span class="k">return</span> <span class="mf">0.</span> <span class="o">+</span> <span class="n">initial_flow</span>

	<span class="k">end</span>
<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-12">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-12">&#182;</a>
  </div>
  <p><code>heart_data.BC_switch</code> = 3 requires a flow waveform to be supplied by the user. The flow waveform is read by the following function:</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-13">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-13">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>inputFromData</code></strong> <span class="math inline">\(\rightarrow\)</span> <code>flow::Float</code></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>t</code></td>
<td><code>::Float</code> current time in seconds.</td>
</tr>
<tr class="even">
<td align="left"><code>h</code></td>
<td><code>::Heart</code> heart data structure.</td>
</tr>
</tbody>
</table>
<p><a name="inputFromData"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">inputFromData</span><span class="p">(</span><span class="n">t</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">h</span> <span class="o">::</span> <span class="n">Heart</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-14">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-14">&#182;</a>
  </div>
  <table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Inlet flow waveform is stored in <code>h</code> data structure inside <code>input_data</code> matrix. <code>input_data</code> has two columns and as many rows as time steps. The first column (<code>input_data[:,1]</code>) contains the time variable. The second column (<code>input_data[:,2]</code>) contains the flow variable. The two arrays are copied into two variables, <code>idt</code> and <code>idq</code> respectively.</td>
</tr>
</tbody>
</table>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">idt</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">input_data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">idq</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">input_data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

</pre></div>
</td>
</tr>

<tr id="section-15">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-15">&#182;</a>
  </div>
  <p><code>t_hat</code> variable tells us how many cardiac cycles have already been simulated. This is calculated with <code>div(a, b)</code> which returns <code>a/b</code>, truncating to an integer.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">t_hat</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">cardiac_T</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-16">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-16">&#182;</a>
  </div>
  <p>The current time is then updated by subtracting as many cardiac cycles as those already passed. This is done in order to have a reference within the cardiac cycle, i.e. in order to know at what point (<em>when</em>) in the cardiac cycle the simulation is running.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">t</span> <span class="o">-=</span> <span class="n">t_hat</span><span class="o">*</span><span class="n">h</span><span class="o">.</span><span class="n">cardiac_T</span>

</pre></div>
</td>
</tr>

<tr id="section-17">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-17">&#182;</a>
  </div>
  <p>The waveform is given in a discrete form and usually with a small amount of points along the cardiac cycle. Usually, the numerical <span class="math inline">\(\Delta t\)</span> is small enough to fall between two time steps reported in <code>idt</code>. This loop skims all the entries in <code>idt</code> and finds the time interval containing the current time <code>t</code>. The variable <code>idx</code> is initialised to zero for simplicity.</p>
<div style="text-align:center">
<img src="images/idt_array.png" width="200">
</div>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">idt</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="n">idt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;=</span> <span class="n">idt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
			<span class="n">idx</span><span class="o">=</span><span class="n">i</span>
			<span class="k">break</span>
		<span class="k">end</span>
	<span class="k">end</span>

</pre></div>
</td>
</tr>

<tr id="section-18">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-18">&#182;</a>
  </div>
  <p>The flow <code>qu</code> is then computed at the current time by a linear interpolation between the two known flows (<code>idq[idx]</code> and <code>idq[idx+1]</code>) at the ends of the time interval.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">qu</span> <span class="o">=</span> <span class="n">idq</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">idt</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">idq</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">idq</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">/</span>
       <span class="p">(</span><span class="n">idt</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">idt</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

</pre></div>
</td>
</tr>

<tr id="section-19">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-19">&#182;</a>
  </div>
  <table>
<colgroup>
<col width="14%" />
<col width="85%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Returns:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>qu</code></td>
<td><code>::Float</code> inlet flow rate at current time.</td>
</tr>
</tbody>
</table>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="k">return</span> <span class="n">qu</span>
<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-20">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-20">&#182;</a>
  </div>
  <p>In the case of veins, the inlet is always coupled with three-element Windkessel. The inlet function is re-defined as follows</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-21">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-21">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>setInletBC</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vein data structure.</td>
</tr>
<tr class="even">
<td align="left"><code>dt</code></td>
<td><code>::Float</code> <span class="math inline">\(\Delta t\)</span>, current time step.</td>
</tr>
<tr class="odd">
<td align="left"><code>Pc</code></td>
<td><code>::Float</code> pressure across the peripheral compliance of the three-element Windkessel.</td>
</tr>
<tr class="even">
<td align="left"><code>R2</code></td>
<td><code>::Float</code> peripeheral resistance of the coupled three-element Windkessel.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">The flow at the first node of the vein (<code>Q[1]</code>) is set as the flow exiting the three-element Windkessel computed as <span class="math display">\[
Q_{vein-in} = \frac{P_c}{R_2},
\]</span> and a small factor of <code>1e-10</code> is added to avoid numerical instabilities. Then, the inlet compatibility relations are computed.</td>
</tr>
</tbody>
</table>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">setInletBC</span><span class="p">(</span><span class="n">v</span>  <span class="o">::</span> <span class="n">Vessel</span><span class="p">,</span>  <span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span>
                    <span class="n">Pc</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">R2</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">)</span>
	<span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pc</span><span class="o">/</span><span class="n">R2</span> <span class="o">+</span> <span class="mf">1e-10</span>

	<span class="n">inletCompatibility</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-22">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-22">&#182;</a>
  </div>
  <p>The inlet compatibility relations are handled by <a href="boundary_conditions.html#inletCompatibility"><code>inletCompatibility</code></a>.</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-23">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-23">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>inletCompatibility</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>dt</code></td>
<td><code>::Float</code> <span class="math inline">\(\Delta t\)</span>, current time step.</td>
</tr>
<tr class="even">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vessel data structure.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Compatibility relations are derived by using a technique called <em>extrapolation of characteristics</em> <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</td>
</tr>
</tbody>
</table>
<p><a name="inletCompatibility"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">inletCompatibility</span><span class="p">(</span><span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">,</span> <span class="n">h</span> <span class="o">::</span> <span class="n">Heart</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-24">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-24">&#182;</a>
  </div>
  <p>Riemann invariants are <a href="converter.html#riemannInvariants">computed</a> starting from variables at time <code>t</code>. <span class="math display">\[
  W_{11}^t = u - 4c, \quad W_{21}^t = u + 4c,
\]</span> are computed at the inlet node of the vessel. <code>W12</code> and <code>W22</code> are the same quantities computed at the second node, i.e. the closest node at the right hand side of the inlet node.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">W11</span><span class="p">,</span> <span class="n">W21</span> <span class="o">=</span> <span class="n">riemannInvariants</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
	<span class="n">W12</span><span class="p">,</span> <span class="n">W22</span> <span class="o">=</span> <span class="n">riemannInvariants</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-25">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-25">&#182;</a>
  </div>
  <p>The two Riemann invariants within the two nodes are extrapolated with a linear law. They reads <span class="math display">\[
  W_{11}^{t+1} = W_{11}^t + \left(W_{12}^t - W_{11}^t \right) (c_1 - u_1)
   \frac{\Delta t}{\Delta x},
\]</span> <span class="math display">\[
  W_{21}^{t+1} = W_{21}^t - W_{11}^{t+1} + 2 \frac{Q_1}{A_1},
\]</span> where the 1 subscript indicates the inlet node.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">W11</span> <span class="o">+=</span> <span class="p">(</span><span class="n">W12</span><span class="o">-</span><span class="n">W11</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">dx</span>
	<span class="n">W21</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">W11</span>

</pre></div>
</td>
</tr>

<tr id="section-26">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-26">&#182;</a>
  </div>
  <p>Longitudinal velocity and wave velocity at the inlet node are retrieved by <a href="converter.html#rI2uc"><code>rI2uc</code></a> (<em>Riemann invariants to u and c</em>) function.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rI2uc</span><span class="p">(</span><span class="n">W11</span><span class="p">,</span> <span class="n">W21</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-27">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-27">&#182;</a>
  </div>
  <p><code>A</code> and <code>P</code> quantities follow from their definitions.</p>

</td>
<td class="code">
<div class="highlight"><pre>
	<span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">inlet_type</span> <span class="o">==</span> <span class="s">&quot;Q&quot;</span>
		<span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">A0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">Pext</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">areaFromPressure</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">A0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">Pext</span><span class="p">)</span>
		<span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">end</span>

<span class="k">end</span>

<span class="k">function</span> <span class="n">inletCompatibility</span><span class="p">(</span><span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">)</span>

	<span class="n">W11</span><span class="p">,</span> <span class="n">W21</span> <span class="o">=</span> <span class="n">riemannInvariants</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
	<span class="n">W12</span><span class="p">,</span> <span class="n">W22</span> <span class="o">=</span> <span class="n">riemannInvariants</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

	<span class="n">W11</span> <span class="o">+=</span> <span class="p">(</span><span class="n">W12</span><span class="o">-</span><span class="n">W11</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">dx</span>
	<span class="n">W21</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">W11</span>

	<span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rI2uc</span><span class="p">(</span><span class="n">W11</span><span class="p">,</span> <span class="n">W21</span><span class="p">)</span>

	<span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">A0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">Pext</span><span class="p">)</span>

<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-28">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-28">&#182;</a>
  </div>
  <p>Outlet boundary condition is applied to the last node of the involved vessel. Two boundary conditions are available. Either a reflection coefficient is provided or a three elements windkessel is coupled.</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-29">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-29">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>setOutletBC</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>dt</code></td>
<td><code>::Float</code> <span class="math inline">\(\Delta t\)</span>, current time step.</td>
</tr>
<tr class="even">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vessel data structure.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Outlet boundary conditions are selected in the <code>project.csv</code> file.</td>
</tr>
</tbody>
</table>
<p><a name="setOutletBC"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">setOutletBC</span><span class="p">(</span><span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-30">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-30">&#182;</a>
  </div>
  <p>A proximal resistance <code>R1</code> set to zero means that a reflection coefficient was specified. Thus, the pressure <code>P</code> is first linearly extrapolated <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> as <span class="math display">\[
  P_M = 2 P_{M-1} - P_{M-2},
\]</span> where <span class="math inline">\(M\)</span> is the index of the vessel outlet node. Then, the compatibility relations are applied by means of <a href="boundary_conditions.html#outletCompatibility"><code>outletCompatibility</code></a> function.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">R1</span> <span class="o">==</span> <span class="mf">0.</span>

		<span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">outletCompatibility</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-31">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-31">&#182;</a>
  </div>
  <p>When all the parameters of the three element windkessel are specified, <a href="boundary_conditions.html#wk3"><code>wk3</code></a> function is called. This function solves lumped parameter equations and it also applies compatibility relations.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="k">else</span>
		<span class="n">wk3</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

	<span class="k">end</span>

<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-32">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-32">&#182;</a>
  </div>
  <p>Outlet compatibility relations compute all the quantities not directly assigned by the outlet boundary condition.</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-33">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-33">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>outletCompatibility</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>dt</code></td>
<td><code>::Float</code> <span class="math inline">\(\Delta t\)</span>, current time step.</td>
</tr>
<tr class="even">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vessel data structure.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Compatibility relations are derived by using a technique called <em>extrapolation of characteristics</em> as for the <a href="boundary_conditions.html#inletCompatibility">inlet</a>.</td>
</tr>
</tbody>
</table>
<p><a name="outletCompatibility"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">outletCompatibility</span><span class="p">(</span><span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">)</span>

	<span class="n">W1M1</span><span class="p">,</span> <span class="n">W2M1</span> <span class="o">=</span> <span class="n">riemannInvariants</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
	<span class="n">W1M</span><span class="p">,</span> <span class="n">W2M</span>   <span class="o">=</span> <span class="n">riemannInvariants</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-34">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-34">&#182;</a>
  </div>
  <p><span class="math display">\[
  W_{2M}^{t+1} = W_2^t + \frac{W_{2 M-1}^t - W_{2M}^t}{\Delta x} (u_M^t
                  + c_M^t) \Delta t,
\]</span> <span class="math display">\[
  W_{1M}^{t+1} = W_{1M}^0 - R_t \left(W_{2L}^{t+1} - W_{2L}^0 \right).
\]</span></p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">W2M</span> <span class="o">+=</span> <span class="p">(</span><span class="n">W2M1</span> <span class="o">-</span> <span class="n">W2M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="k">end</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">dx</span>
	<span class="n">W1M</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">W1M0</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">Rt</span> <span class="o">*</span> <span class="p">(</span><span class="n">W2M</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">W2M0</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-35">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-35">&#182;</a>
  </div>
  <p>Here the remaining quatities are computed by means of their definitions.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">rI2uc</span><span class="p">(</span><span class="n">W1M</span><span class="p">,</span> <span class="n">W2M</span><span class="p">)</span>
	<span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>

<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-36">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-36">&#182;</a>
  </div>
  <p>The three element windkessel simulates the perfusion of downstream vessels. This 0D model is coupled by <a href="boundary_conditions.html#wk3"><code>wk3</code></a> function to 1D model terminal branches via the solution of a Riemann problem at the 0D/1D interface.</p>
<div style="text-align:center">
<img src="images/wk3.pdf.png" width="250">
</div>
<p><span class="math inline">\(R_1\)</span> is the proximal resistance, <span class="math inline">\(R_2\)</span> is the peripeheral reisistance, <span class="math inline">\(C_c\)</span> is the peripheral compliance, <span class="math inline">\(P_c\)</span> is the pressure across the peripheral compliance, <span class="math inline">\(P_out\)</span> is the pressure at the artery-vein interface, <span class="math inline">\(P_e\)</span> is the pressure at the 0D/1D interface.</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-37">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-37">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>wk3</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>dt</code></td>
<td><code>::Float</code> <span class="math inline">\(\Delta t\)</span>, current time step.</td>
</tr>
<tr class="even">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vessel data structure.</td>
</tr>
</tbody>
</table>
<p><a name="wk3"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">wk3</span><span class="p">(</span><span class="n">dt</span> <span class="o">::</span> <span class="kt">Float64</span><span class="p">,</span> <span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-38">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-38">&#182;</a>
  </div>
  <table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">At capillary level the pressure is assumed to be zero, i.e. <span class="math inline">\(P_{out}=0.\)</span></td>
</tr>
</tbody>
</table>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">Pout</span> <span class="o">=</span> <span class="mf">0.</span>

</pre></div>
</td>
</tr>

<tr id="section-39">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-39">&#182;</a>
  </div>
  <p>The coupling is performed by assuming that an intermediate state <span class="math inline">\((A^*,u^*)\)</span> generates from <span class="math inline">\((A_l,u_l)\)</span> (1D outlet) and <span class="math inline">\((A_r,u_r)\)</span> (0D inlet). This intermediate state must satisfy the windkessel equation <span class="math display">\[
  A^*u^* \left(1 + \frac{R_1}{R_2}\right) + C_c R_1 \frac{\partial
  (A^*u^*)}{\partial t} = \frac{P_e - P_{out}}{R_2} + C_c \frac{\partial
  P_e}{\partial t}.
\]</span></p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">Al</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
	<span class="n">ul</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>

</pre></div>
</td>
</tr>

<tr id="section-40">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-40">&#182;</a>
  </div>
  <p><span class="math inline">\(P_c\)</span> is computed at each time step from <span class="math display">\[
  C_c \frac{\partial P_c}{\partial t} = A^*u^* - \frac{P_c -
  P_{out}}{R_2},
\]</span> which is discretised numerically with a first-order scheme. <span class="math inline">\(P_c\)</span> is is <a href="initialise.html#initialiseVessel">initialised</a> to zero.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">v</span><span class="o">.</span><span class="n">Pc</span> <span class="o">+=</span> <span class="n">dt</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">Cc</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span><span class="o">*</span><span class="n">ul</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">Pc</span><span class="o">-</span><span class="n">Pout</span><span class="p">)</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-41">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-41">&#182;</a>
  </div>
  <p>We consider <span class="math inline">\(\beta\)</span> and <span class="math inline">\(A_0\)</span> to be the same on both sides of the 0D/1D interface. It yields the nonlinear equation <span class="math display">\[
  \mathcal{F}(A^*) = A^*R_1\left(u_l+4c_l\right)
  -4A^*R_1c^* - \frac{\beta}{A_0}\left(
  \sqrt{A^*}-\sqrt{A_0}\right) + P_c = 0,
\]</span> where <span class="math inline">\(c_l\)</span> and <span class="math inline">\(c^*\)</span> are the wave speeds calculated with <span class="math inline">\(A_l\)</span> and <span class="math inline">\(A^*\)</span>, respectively.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">As</span> <span class="o">=</span> <span class="n">Al</span>


</pre></div>
</td>
</tr>

<tr id="section-42">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-42">&#182;</a>
  </div>
  <p>fun(As) = v.R1<em>(ul+4</em>sqrt(3<em>v.gamma[end]</em>sqrt(Al)<em>0.5))</em>As - 4<em>v.R1</em>sqrt(3<em>v.gamma[end]</em>sqrt(As)<em>0.5)</em>As - (v.Pext + v.beta[end]*(sqrt(As/v.A0[end]) - 1)) + v.Pc</p>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

<tr id="section-43">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-43">&#182;</a>
  </div>
  <p>dfun(As) = v.R1<em>( ul +4</em>sqrt(1.5<em>v.gamma[end])</em>(sqrt(sqrt(Al)) - 1.25<em>sqrt(sqrt(As))) ) - v.beta[end]</em>0.5/(sqrt(As*v.A0[end]))</p>

</td>
<td class="code">
<div class="highlight"><pre>
	<span class="n">ssAl</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Al</span><span class="p">))</span>
	<span class="n">sgamma</span> <span class="o">=</span>  <span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
	<span class="n">sA0</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">A0</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
	<span class="n">bA0</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">/</span><span class="n">sA0</span>

	<span class="n">fun</span><span class="p">(</span><span class="n">As</span><span class="p">)</span> <span class="o">=</span> <span class="n">As</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">R1</span><span class="o">*</span><span class="p">(</span><span class="n">ul</span> <span class="o">+</span> <span class="n">sgamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">ssAl</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">As</span><span class="p">))))</span> <span class="o">-</span>
		<span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">Pext</span> <span class="o">+</span> <span class="n">bA0</span><span class="o">*</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">As</span><span class="p">)</span> <span class="o">-</span> <span class="n">sA0</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">Pc</span>

	<span class="n">dfun</span><span class="p">(</span><span class="n">As</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">R1</span><span class="o">*</span><span class="p">(</span><span class="n">ul</span> <span class="o">+</span> <span class="n">sgamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">ssAl</span> <span class="o">-</span> <span class="mf">1.25</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">As</span><span class="p">))))</span> <span class="o">-</span> <span class="n">bA0</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">As</span><span class="p">)</span>


</pre></div>
</td>
</tr>

<tr id="section-44">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-44">&#182;</a>
  </div>
  <p><span class="math inline">\(\mathcal{F}(A^*)=0\)</span> is solved for <span class="math inline">\(A^*\)</span> with the Newton’s method implemented in <a href="https://github.com/JuliaLang/Roots.jl"><strong>Roots</strong></a> library. <span class="math inline">\(A^*\)</span> is initialised equal to <span class="math inline">\(A_l\)</span>. As = newton(fun, dfun, As)</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">As</span> <span class="o">=</span> <span class="n">newtone</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">dfun</span><span class="p">,</span> <span class="n">As</span><span class="p">)</span>

</pre></div>
</td>
</tr>

<tr id="section-45">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-45">&#182;</a>
  </div>
  <p>Once <span class="math inline">\(A^*\)</span> is found, <span class="math inline">\(u^*\)</span> reads <span class="math display">\[
  u^* = \frac{P_e^* - P{out}}{A^*R_1},
\]</span> where <span class="math inline">\(P_e^*\)</span> is <span class="math inline">\(P_e\)</span> calculated with <span class="math inline">\(A^*\)</span>.</p>

</td>
<td class="code">
<div class="highlight"><pre>	<span class="n">us</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">As</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">A0</span><span class="p">[</span><span class="k">end</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="k">end</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">Pext</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pout</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">As</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">R1</span><span class="p">)</span>

	<span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">As</span>
	<span class="n">v</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">us</span>

<span class="k">end</span>

<span class="k">function</span> <span class="n">newtone</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>

	<span class="n">xn</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">df</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">abs</span><span class="p">(</span><span class="n">xn</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">&lt;=</span> <span class="mf">1e-5</span>
		<span class="k">return</span> <span class="n">xn</span>
	<span class="k">else</span>
		<span class="n">newtone</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">xn</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>



</pre></div>
</td>
</tr>

<tr id="section-46">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-46">&#182;</a>
  </div>
  <p><em>function</em> <strong><code>updateGhostCells</code></strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameters:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>v</code></td>
<td><code>::Vessel</code> vessel data structure.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Functioning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Ghost cells are updated by assuming both ends as transmissive boundaries.</td>
</tr>
</tbody>
</table>
<p><a name="updateGhostCells"></a></p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">updateGhostCells</span><span class="p">(</span><span class="n">v</span> <span class="o">::</span> <span class="n">Vessel</span><span class="p">)</span>

	<span class="n">v</span><span class="o">.</span><span class="n">U00A</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">U00Q</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">U01A</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">U01Q</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

	<span class="n">v</span><span class="o">.</span><span class="n">UM1A</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">M</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">UM1Q</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">M</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">UM2A</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">v</span><span class="o">.</span><span class="n">UM2Q</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-47">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-47">&#182;</a>
  </div>
  <p><code>updateGhostCells</code> exploits julia’s multiple dispatch property. This function can handle one or more than one vessels organised in an <code>Array</code> structure.</p>

</td>
<td class="code">
<div class="highlight"><pre><span class="k">function</span> <span class="n">updateGhostCells</span><span class="p">(</span><span class="n">vessels</span> <span class="o">::</span> <span class="kt">Array</span><span class="p">{</span><span class="n">Vessel</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span>

	<span class="k">for</span> <span class="n">vessel</span> <span class="kp">in</span> <span class="n">vessels</span>
		<span class="n">updateGhostCells</span><span class="p">(</span><span class="n">vessel</span><span class="p">)</span>
	<span class="k">end</span>

<span class="k">end</span>


</pre></div>
</td>
</tr>

<tr id="section-48">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-48">&#182;</a>
  </div>
  <h3 id="references">References</h3>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Peiro, Joaquim, and Alessandro Veneziani. <a href="http://link.springer.com/chapter/10.1007/978-88-470-1152-6_10#page-1"><em>“Reduced models of the cardiovascular system .”</em></a> In Cardiovascular mathematics, pp. 347-394. Springer Milan, 2009.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Anderson, John David, and J. Wendt. <em>Computational fluid dynamics</em>. Vol. 206. New York: McGraw-Hill, 1995.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Fernandez, Miguel Angel, Vuk Milisic, and Alfio Quarteroni. <a href="http://epubs.siam.org/doi/abs/10.1137/030602010"><em>“Analysis of a geometrical multiscale blood flow model based on the coupling of ODEs and hyperbolic PDEs.”</em></a> Multiscale Modeling &amp; Simulation 4.1 (2005): 215-236.<a href="#fnref3">↩</a></p></li>
</ol>
</div>

</td>
<td class="code">
<div class="highlight"><pre>

</pre></div>
</td>
</tr>

      </tbody>
    </table>
  </div>
<nav>
  <ul>
    <li><a href="#">^</a></li>
    <li><a href="../doc-index.html">API index</a></li>
  </ul>
</nav>
</body>
</html>
